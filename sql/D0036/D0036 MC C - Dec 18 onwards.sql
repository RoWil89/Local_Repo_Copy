
-- d0036 HH Model
-- This Version references WH to retrive measurement class and filters to HH only
-- Commented out variables relating to before December 2018 as not receving D0036s from all agents

USE D0036;

--SET ansi_warnings ON
--GO

DECLARE @Count INT = 1

DECLARE @Variables AS TABLE (

	    id  INT         IDENTITY(1, 1) NOT NULL
		,[Sett Date] DATE
		,[DA Run Date] DATE
		,[Sett Code] VARCHAR(2)
);

INSERT INTO @Variables
(
		 [Sett Date]
		,[DA Run Date]
		,[Sett Code]
)
VALUES

--('2018/04/01','2018/04/19','SF'),
--('2018/04/02','2018/04/19','SF'),
--('2018/04/03','2018/04/20','SF'),
--('2018/04/04','2018/04/23','SF'),
--('2018/04/05','2018/04/24','SF'),
--('2018/04/06','2018/04/25','SF'),
--('2018/04/07','2018/04/25','SF'),
--('2018/04/08','2018/04/25','SF'),
--('2018/04/09','2018/04/26','SF'),
--('2018/04/10','2018/04/27','SF'),
--('2018/04/11','2018/04/30','SF'),
--('2018/04/12','2018/05/01','SF'),
--('2018/04/13','2018/05/02','SF'),
--('2018/04/14','2018/05/02','SF'),
--('2018/04/15','2018/05/02','SF'),
--('2018/04/16','2018/05/03','SF'),
--('2018/04/17','2018/05/04','SF'),
--('2018/04/18','2018/05/08','SF'),
--('2018/04/19','2018/05/09','SF'),
--('2018/04/20','2018/05/10','SF'),
--('2018/04/21','2018/05/10','SF'),
--('2018/04/22','2018/05/10','SF'),
--('2018/04/23','2018/05/11','SF'),
--('2018/04/24','2018/05/14','SF'),
--('2018/04/25','2018/05/15','SF'),
--('2018/04/26','2018/05/16','SF'),
--('2018/04/27','2018/05/17','SF'),
--('2018/04/28','2018/05/17','SF'),
--('2018/04/29','2018/05/17','SF'),
--('2018/04/30','2018/05/18','SF'),
--('2018/05/01','2018/05/21','SF'),
--('2018/05/02','2018/05/22','SF'),
--('2018/05/03','2018/05/23','SF'),
--('2018/05/04','2018/05/24','SF'),
--('2018/05/05','2018/05/24','SF'),
--('2018/05/06','2018/05/24','SF'),
--('2018/05/07','2018/05/24','SF'),
--('2018/05/08','2018/05/25','SF'),
--('2018/05/09','2018/05/29','SF'),
--('2018/05/10','2018/05/30','SF'),
--('2018/05/11','2018/05/31','SF'),
--('2018/05/12','2018/05/31','SF'),
--('2018/05/13','2018/05/31','SF'),
--('2018/05/14','2018/06/01','SF'),
--('2018/05/15','2018/06/04','SF'),
--('2018/05/16','2018/06/05','SF'),
--('2018/05/17','2018/06/06','SF'),
--('2018/05/18','2018/06/07','SF'),
--('2018/05/19','2018/06/07','SF'),
--('2018/05/20','2018/06/07','SF'),
--('2018/05/21','2018/06/08','SF'),
--('2018/05/22','2018/06/11','SF'),
--('2018/05/23','2018/06/12','SF'),
--('2018/05/24','2018/06/13','SF'),
--('2018/05/25','2018/06/14','SF'),
--('2018/05/26','2018/06/14','SF'),
--('2018/05/27','2018/06/14','SF'),
--('2018/05/28','2018/06/14','SF'),
--('2018/05/29','2018/06/15','SF'),
--('2018/05/30','2018/06/18','SF'),
--('2018/05/31','2018/06/19','SF'),
--('2018/06/01','2018/06/20','SF'),
--('2018/06/02','2018/06/20','SF'),
--('2018/06/03','2018/06/20','SF'),
--('2018/06/04','2018/06/21','SF'),
--('2018/06/05','2018/06/22','SF'),
--('2018/06/06','2018/06/25','SF'),
--('2018/06/07','2018/06/26','SF'),
--('2018/06/08','2018/06/27','SF'),
--('2018/06/09','2018/06/27','SF'),
--('2018/06/10','2018/06/27','SF'),
--('2018/06/11','2018/06/28','SF'),
--('2018/06/12','2018/06/29','SF'),
--('2018/06/13','2018/07/02','SF'),
--('2018/06/14','2018/07/03','SF'),
--('2018/06/15','2018/07/04','SF'),
--('2018/06/16','2018/07/04','SF'),
--('2018/06/17','2018/07/04','SF'),
--('2018/06/18','2018/07/05','SF'),
--('2018/06/19','2018/07/06','SF'),
--('2018/06/20','2018/07/09','SF'),
--('2018/06/21','2018/07/10','SF'),
--('2018/06/22','2018/07/11','SF'),
--('2018/06/23','2018/07/11','SF'),
--('2018/06/24','2018/07/11','SF'),
--('2018/06/25','2018/07/12','SF'),
--('2018/06/26','2018/07/13','SF'),
--('2018/06/27','2018/07/16','SF'),
--('2018/06/28','2018/07/17','SF'),
--('2018/06/29','2018/07/18','SF'),
--('2018/06/30','2018/07/18','SF'),
--('2018/07/01','2018/07/18','SF'),
--('2018/07/02','2018/07/19','SF'),
--('2018/07/03','2018/07/20','SF'),
--('2018/07/04','2018/07/23','SF'),
--('2018/07/05','2018/07/24','SF'),
--('2018/07/06','2018/07/25','SF'),
--('2018/07/07','2018/07/25','SF'),
--('2018/07/08','2018/07/25','SF'),
--('2018/07/09','2018/07/26','SF'),
--('2018/07/10','2018/07/27','SF'),
--('2018/07/11','2018/07/30','SF'),
--('2018/07/12','2018/07/31','SF'),
--('2018/07/13','2018/08/01','SF'),
--('2018/07/14','2018/08/01','SF'),
--('2018/07/15','2018/08/01','SF'),
--('2018/07/16','2018/08/02','SF'),
--('2018/07/17','2018/08/03','SF'),
--('2018/07/18','2018/08/06','SF'),
--('2018/07/19','2018/08/07','SF'),
--('2018/07/20','2018/08/08','SF'),
--('2018/07/21','2018/08/08','SF'),
--('2018/07/22','2018/08/08','SF'),
--('2018/07/23','2018/08/09','SF'),
--('2018/07/24','2018/08/10','SF'),
--('2018/07/25','2018/08/13','SF'),
--('2018/07/26','2018/08/14','SF'),
--('2018/07/27','2018/08/15','SF'),
--('2018/07/28','2018/08/15','SF'),
--('2018/07/29','2018/08/15','SF'),
--('2018/07/30','2018/08/16','SF'),
--('2018/07/31','2018/08/17','SF'),
--('2018/08/01','2018/08/20','SF'),
--('2018/08/02','2018/08/21','SF'),
--('2018/08/03','2018/08/22','SF'),
--('2018/08/04','2018/08/22','SF'),
--('2018/08/05','2018/08/22','SF'),
--('2018/08/06','2018/08/23','SF'),
--('2018/08/07','2018/08/24','SF'),
--('2018/08/08','2018/08/28','SF'),
--('2018/08/09','2018/08/29','SF'),
--('2018/08/10','2018/08/30','SF'),
--('2018/08/11','2018/08/30','SF'),
--('2018/08/12','2018/08/30','SF'),
--('2018/08/13','2018/08/31','SF'),
--('2018/08/14','2018/09/03','SF'),
--('2018/08/15','2018/09/04','SF'),
--('2018/08/16','2018/09/05','SF'),
--('2018/08/17','2018/09/06','SF'),
--('2018/08/18','2018/09/06','SF'),
--('2018/08/19','2018/09/06','SF'),
--('2018/08/20','2018/09/07','SF'),
--('2018/08/21','2018/09/10','SF'),
--('2018/08/22','2018/09/11','SF'),
--('2018/08/23','2018/09/12','SF'),
--('2018/08/24','2018/09/13','SF'),
--('2018/08/25','2018/09/13','SF'),
--('2018/08/26','2018/09/13','SF'),
--('2018/08/27','2018/09/13','SF'),
--('2018/08/28','2018/09/14','SF'),
--('2018/08/29','2018/09/17','SF'),
--('2018/08/30','2018/09/18','SF'),
--('2018/08/31','2018/09/19','SF'),
--('2018/09/01','2018/09/19','SF'),
--('2018/09/02','2018/09/19','SF'),
--('2018/09/03','2018/09/20','SF'),
--('2018/09/04','2018/09/21','SF'),
--('2018/09/05','2018/09/24','SF'),
--('2018/09/06','2018/09/25','SF'),
--('2018/09/07','2018/09/26','SF'),
--('2018/09/08','2018/09/26','SF'),
--('2018/09/09','2018/09/26','SF'),
--('2018/09/10','2018/09/27','SF'),
--('2018/09/11','2018/09/28','SF'),
--('2018/09/12','2018/10/01','SF'),
--('2018/09/13','2018/10/02','SF'),
--('2018/09/14','2018/10/03','SF'),
--('2018/09/15','2018/10/03','SF'),
--('2018/09/16','2018/10/03','SF'),
--('2018/09/17','2018/10/04','SF'),
--('2018/09/18','2018/10/05','SF'),
--('2018/09/19','2018/10/08','SF'),
--('2018/09/20','2018/10/09','SF'),
--('2018/09/21','2018/10/10','SF'),
--('2018/09/22','2018/10/10','SF'),
--('2018/09/23','2018/10/10','SF'),
--('2018/09/24','2018/10/11','SF'),
--('2018/09/25','2018/10/12','SF'),
--('2018/09/26','2018/10/15','SF'),
--('2018/09/27','2018/10/16','SF'),
--('2018/09/28','2018/10/17','SF'),
--('2018/09/29','2018/10/17','SF'),
--('2018/09/30','2018/10/17','SF'),
--('2018/10/01','2018/10/18','SF'),
--('2018/10/02','2018/10/19','SF'),
--('2018/10/03','2018/10/22','SF'),
--('2018/10/04','2018/10/23','SF'),
--('2018/10/05','2018/10/24','SF'),
--('2018/10/06','2018/10/24','SF'),
--('2018/10/07','2018/10/24','SF'),
--('2018/10/08','2018/10/25','SF'),
--('2018/10/09','2018/10/26','SF'),
--('2018/10/10','2018/10/29','SF'),
--('2018/10/11','2018/10/30','SF'),
--('2018/10/12','2018/10/31','SF'),
--('2018/10/13','2018/10/31','SF'),
--('2018/10/14','2018/10/31','SF'),
--('2018/10/15','2018/11/01','SF'),
--('2018/10/16','2018/11/02','SF'),
--('2018/10/17','2018/11/05','SF'),
--('2018/10/18','2018/11/06','SF'),
--('2018/10/19','2018/11/07','SF'),
--('2018/10/20','2018/11/07','SF'),
--('2018/10/21','2018/11/07','SF'),
--('2018/10/22','2018/11/08','SF'),
--('2018/10/23','2018/11/09','SF'),
--('2018/10/24','2018/11/12','SF'),
--('2018/10/25','2018/11/13','SF'),
--('2018/10/26','2018/11/14','SF'),
--('2018/10/27','2018/11/14','SF'),
--('2018/10/28','2018/11/14','SF'),
--('2018/10/29','2018/11/15','SF'),
--('2018/10/30','2018/11/16','SF'),
--('2018/10/31','2018/11/19','SF'),
--('2018/11/01','2018/11/20','SF'),
--('2018/11/02','2018/11/21','SF'),
--('2018/11/03','2018/11/21','SF'),
--('2018/11/04','2018/11/21','SF'),
--('2018/11/05','2018/11/22','SF'),
--('2018/11/06','2018/11/23','SF'),
--('2018/11/07','2018/11/26','SF'),
--('2018/11/08','2018/11/27','SF'),
--('2018/11/09','2018/11/28','SF'),
--('2018/11/10','2018/11/28','SF'),
--('2018/11/11','2018/11/28','SF'),
--('2018/11/12','2018/11/29','SF'),
--('2018/11/13','2018/11/30','SF'),
--('2018/11/14','2018/12/03','SF'),
--('2018/11/15','2018/12/04','SF'),
--('2018/11/16','2018/12/05','SF'),
--('2018/11/17','2018/12/05','SF'),
--('2018/11/18','2018/12/05','SF'),
--('2018/11/19','2018/12/06','SF'),
--('2018/11/20','2018/12/07','SF'),
--('2018/11/21','2018/12/10','SF'),
--('2018/11/22','2018/12/11','SF'),
--('2018/11/23','2018/12/12','SF'),
--('2018/11/24','2018/12/12','SF'),
--('2018/11/25','2018/12/12','SF'),
--('2018/11/26','2018/12/13','SF'),
--('2018/11/27','2018/12/14','SF'),
--('2018/11/28','2018/12/17','SF'),
--('2018/11/29','2018/12/18','SF'),
--('2018/11/30','2018/12/19','SF'),
('2018/12/01','2018/12/19','SF'),
('2018/12/02','2018/12/19','SF'),
('2018/12/03','2018/12/20','SF'),
('2018/12/04','2018/12/21','SF'),
('2018/12/05','2018/12/24','SF'),
('2018/12/06','2018/12/27','SF'),
('2018/12/07','2018/12/28','SF'),
('2018/12/08','2018/12/28','SF'),
('2018/12/09','2018/12/28','SF'),
('2018/12/10','2018/12/31','SF'),
('2018/12/11','2019/01/02','SF'),
('2018/12/12','2019/01/03','SF'),
('2018/12/13','2019/01/04','SF'),
('2018/12/14','2019/01/07','SF'),
('2018/12/15','2019/01/07','SF'),
('2018/12/16','2019/01/07','SF'),
('2018/12/17','2019/01/08','SF'),
('2018/12/18','2019/01/09','SF'),
('2018/12/19','2019/01/10','SF'),
('2018/12/20','2019/01/11','SF'),
('2018/12/21','2019/01/14','SF'),
('2018/12/22','2019/01/14','SF'),
('2018/12/23','2019/01/14','SF'),
('2018/12/24','2019/01/15','SF'),
('2018/12/25','2019/01/15','SF'),
('2018/12/26','2019/01/15','SF'),
('2018/12/27','2019/01/16','SF'),
('2018/12/28','2019/01/17','SF'),
('2018/12/29','2019/01/17','SF'),
('2018/12/30','2019/01/17','SF'),
('2018/12/31','2019/01/18','SF'),
('2019/01/01','2019/01/18','SF'),
('2019/01/02','2019/01/21','SF'),
('2019/01/03','2019/01/22','SF'),
('2019/01/04','2019/01/23','SF'),
('2019/01/05','2019/01/23','SF'),
('2019/01/06','2019/01/23','SF'),
('2019/01/07','2019/01/24','SF'),
('2019/01/08','2019/01/25','SF'),
('2019/01/09','2019/01/28','SF'),
('2019/01/10','2019/01/29','SF'),
('2019/01/11','2019/01/30','SF'),
('2019/01/12','2019/01/30','SF'),
('2019/01/13','2019/01/30','SF'),
('2019/01/14','2019/01/31','SF'),
('2019/01/15','2019/02/01','SF'),
('2019/01/16','2019/02/04','SF'),
('2019/01/17','2019/02/05','SF'),
('2019/01/18','2019/02/06','SF'),
('2019/01/19','2019/02/06','SF'),
('2019/01/20','2019/02/06','SF'),
('2019/01/21','2019/02/07','SF'),
('2019/01/22','2019/02/08','SF'),
('2019/01/23','2019/02/11','SF'),
('2019/01/24','2019/02/12','SF'),
('2019/01/25','2019/02/13','SF'),
('2019/01/26','2019/02/13','SF'),
('2019/01/27','2019/02/13','SF'),
('2019/01/28','2019/02/14','SF'),
('2019/01/29','2019/02/15','SF'),
('2019/01/30','2019/02/18','SF'),
('2019/01/31','2019/02/19','SF'),
('2019/02/01','2019/02/20','SF'),
('2019/02/02','2019/02/20','SF'),
('2019/02/03','2019/02/20','SF'),
('2019/02/04','2019/02/21','SF'),
('2019/02/05','2019/02/22','SF'),
('2019/02/06','2019/02/25','SF'),
('2019/02/07','2019/02/26','SF'),
('2019/02/08','2019/02/27','SF'),
('2019/02/09','2019/02/27','SF'),
('2019/02/10','2019/02/27','SF'),
('2019/02/11','2019/02/28','SF'),
('2019/02/12','2019/03/01','SF'),
('2019/02/13','2019/03/04','SF'),
('2019/02/14','2019/03/05','SF'),
('2019/02/15','2019/03/06','SF'),
('2019/02/16','2019/03/06','SF'),
('2019/02/17','2019/03/06','SF'),
('2019/02/18','2019/03/07','SF'),
('2019/02/19','2019/03/08','SF'),
('2019/02/20','2019/03/11','SF'),
('2019/02/21','2019/03/12','SF'),
('2019/02/22','2019/03/13','SF'),
('2019/02/23','2019/03/13','SF'),
('2019/02/24','2019/03/13','SF'),
('2019/02/25','2019/03/14','SF'),
('2019/02/26','2019/03/15','SF'),
('2019/02/27','2019/03/18','SF'),
('2019/02/28','2019/03/19','SF'),
('2019/03/01','2019/03/20','SF'),
('2019/03/02','2019/03/20','SF'),
('2019/03/03','2019/03/20','SF'),
('2019/03/04','2019/03/21','SF'),
('2019/03/05','2019/03/22','SF'),
('2019/03/06','2019/03/25','SF'),
('2019/03/07','2019/03/26','SF'),
('2019/03/08','2019/03/27','SF'),
('2019/03/09','2019/03/27','SF'),
('2019/03/10','2019/03/27','SF'),
('2019/03/11','2019/03/28','SF'),
('2019/03/12','2019/03/29','SF'),
('2019/03/13','2019/04/01','SF'),
('2019/03/14','2019/04/02','SF'),
('2019/03/15','2019/04/03','SF'),
('2019/03/16','2019/04/03','SF'),
('2019/03/17','2019/04/03','SF'),
('2019/03/18','2019/04/04','SF'),
('2019/03/19','2019/04/05','SF'),
('2019/03/20','2019/04/08','SF'),
('2019/03/21','2019/04/09','SF'),
('2019/03/22','2019/04/10','SF'),
('2019/03/23','2019/04/10','SF'),
('2019/03/24','2019/04/10','SF'),
('2019/03/25','2019/04/11','SF'),
('2019/03/26','2019/04/12','SF'),
('2019/03/27','2019/04/15','SF'),
('2019/03/28','2019/04/16','SF'),
('2019/03/29','2019/04/17','SF'),
('2019/03/30','2019/04/17','SF'),
('2019/03/31','2019/04/17','SF'),
--('2018/03/06','2018/04/23','R1'),
--('2018/03/07','2018/04/24','R1'),
--('2018/03/08','2018/04/25','R1'),
--('2018/03/09','2018/04/25','R1'),
--('2018/03/10','2018/04/26','R1'),
--('2018/03/11','2018/04/26','R1'),
--('2018/03/12','2018/04/27','R1'),
--('2018/03/13','2018/04/30','R1'),
--('2018/03/14','2018/05/01','R1'),
--('2018/03/15','2018/05/02','R1'),
--('2018/03/16','2018/05/02','R1'),
--('2018/03/17','2018/05/03','R1'),
--('2018/03/18','2018/05/03','R1'),
--('2018/03/19','2018/05/04','R1'),
--('2018/03/20','2018/05/08','R1'),
--('2018/03/21','2018/05/09','R1'),
--('2018/03/22','2018/05/10','R1'),
--('2018/03/23','2018/05/10','R1'),
--('2018/03/24','2018/05/11','R1'),
--('2018/03/25','2018/05/11','R1'),
--('2018/03/26','2018/05/14','R1'),
--('2018/03/27','2018/05/15','R1'),
--('2018/03/28','2018/05/16','R1'),
--('2018/03/29','2018/05/16','R1'),
--('2018/03/30','2018/05/17','R1'),
--('2018/03/31','2018/05/17','R1'),
--('2018/04/01','2018/05/17','R1'),
--('2018/04/02','2018/05/17','R1'),
--('2018/04/03','2018/05/18','R1'),
--('2018/04/04','2018/05/21','R1'),
--('2018/04/05','2018/05/22','R1'),
--('2018/04/06','2018/05/23','R1'),
--('2018/04/07','2018/05/23','R1'),
--('2018/04/08','2018/05/23','R1'),
--('2018/04/09','2018/05/24','R1'),
--('2018/04/10','2018/05/25','R1'),
--('2018/04/11','2018/05/29','R1'),
--('2018/04/12','2018/05/30','R1'),
--('2018/04/13','2018/05/30','R1'),
--('2018/04/14','2018/05/31','R1'),
--('2018/04/15','2018/05/31','R1'),
--('2018/04/16','2018/06/01','R1'),
--('2018/04/17','2018/06/01','R1'),
--('2018/04/18','2018/06/05','R1'),
--('2018/04/19','2018/06/06','R1'),
--('2018/04/20','2018/06/06','R1'),
--('2018/04/21','2018/06/07','R1'),
--('2018/04/22','2018/06/07','R1'),
--('2018/04/23','2018/06/08','R1'),
--('2018/04/24','2018/06/11','R1'),
--('2018/04/25','2018/06/12','R1'),
--('2018/04/26','2018/06/13','R1'),
--('2018/04/27','2018/06/13','R1'),
--('2018/04/28','2018/06/13','R1'),
--('2018/04/29','2018/06/14','R1'),
--('2018/04/30','2018/06/14','R1'),
--('2018/05/01','2018/06/18','R1'),
--('2018/05/02','2018/06/19','R1'),
--('2018/05/03','2018/06/19','R1'),
--('2018/05/04','2018/06/20','R1'),
--('2018/05/05','2018/06/20','R1'),
--('2018/05/06','2018/06/20','R1'),
--('2018/05/07','2018/06/20','R1'),
--('2018/05/08','2018/06/22','R1'),
--('2018/05/09','2018/06/25','R1'),
--('2018/05/10','2018/06/26','R1'),
--('2018/05/11','2018/06/27','R1'),
--('2018/05/12','2018/06/27','R1'),
--('2018/05/13','2018/06/27','R1'),
--('2018/05/14','2018/06/27','R1'),
--('2018/05/15','2018/06/29','R1'),
--('2018/05/16','2018/07/02','R1'),
--('2018/05/17','2018/07/03','R1'),
--('2018/05/18','2018/07/04','R1'),
--('2018/05/19','2018/07/04','R1'),
--('2018/05/20','2018/07/04','R1'),
--('2018/05/21','2018/07/04','R1'),
--('2018/05/22','2018/07/06','R1'),
--('2018/05/23','2018/07/09','R1'),
--('2018/05/24','2018/07/10','R1'),
--('2018/05/25','2018/07/10','R1'),
--('2018/05/26','2018/07/10','R1'),
--('2018/05/27','2018/07/11','R1'),
--('2018/05/28','2018/07/11','R1'),
--('2018/05/29','2018/07/11','R1'),
--('2018/05/30','2018/07/13','R1'),
--('2018/05/31','2018/07/16','R1'),
--('2018/06/01','2018/07/17','R1'),
--('2018/06/02','2018/07/17','R1'),
--('2018/06/03','2018/07/17','R1'),
--('2018/06/04','2018/07/18','R1'),
--('2018/06/05','2018/07/19','R1'),
--('2018/06/06','2018/07/20','R1'),
--('2018/06/07','2018/07/23','R1'),
--('2018/06/08','2018/07/24','R1'),
--('2018/06/09','2018/07/24','R1'),
--('2018/06/10','2018/07/24','R1'),
--('2018/06/11','2018/07/24','R1'),
--('2018/06/12','2018/07/25','R1'),
--('2018/06/13','2018/07/27','R1'),
--('2018/06/14','2018/07/30','R1'),
--('2018/06/15','2018/07/30','R1'),
--('2018/06/16','2018/07/31','R1'),
--('2018/06/17','2018/07/31','R1'),
--('2018/06/18','2018/08/01','R1'),
--('2018/06/19','2018/08/02','R1'),
--('2018/06/20','2018/08/03','R1'),
--('2018/06/21','2018/08/06','R1'),
--('2018/06/22','2018/08/07','R1'),
--('2018/06/23','2018/08/07','R1'),
--('2018/06/24','2018/08/07','R1'),
--('2018/06/25','2018/08/08','R1'),
--('2018/06/26','2018/08/09','R1'),
--('2018/06/27','2018/08/10','R1'),
--('2018/06/28','2018/08/13','R1'),
--('2018/06/29','2018/08/14','R1'),
--('2018/06/30','2018/08/14','R1'),
--('2018/07/01','2018/08/14','R1'),
--('2018/07/02','2018/08/15','R1'),
--('2018/07/03','2018/08/16','R1'),
--('2018/07/04','2018/08/17','R1'),
--('2018/07/05','2018/08/20','R1'),
--('2018/07/06','2018/08/21','R1'),
--('2018/07/07','2018/08/21','R1'),
--('2018/07/08','2018/08/21','R1'),
--('2018/07/09','2018/08/22','R1'),
--('2018/07/10','2018/08/23','R1'),
--('2018/07/11','2018/08/24','R1'),
--('2018/07/12','2018/08/28','R1'),
--('2018/07/13','2018/08/29','R1'),
--('2018/07/14','2018/08/29','R1'),
--('2018/07/15','2018/08/29','R1'),
--('2018/07/16','2018/08/29','R1'),
--('2018/07/17','2018/08/31','R1'),
--('2018/07/18','2018/09/03','R1'),
--('2018/07/19','2018/09/04','R1'),
--('2018/07/20','2018/09/05','R1'),
--('2018/07/21','2018/09/05','R1'),
--('2018/07/22','2018/09/05','R1'),
--('2018/07/23','2018/09/05','R1'),
--('2018/07/24','2018/09/07','R1'),
--('2018/07/25','2018/09/10','R1'),
--('2018/07/26','2018/09/11','R1'),
--('2018/07/27','2018/09/12','R1'),
--('2018/07/28','2018/09/12','R1'),
--('2018/07/29','2018/09/12','R1'),
--('2018/07/30','2018/09/12','R1'),
--('2018/07/31','2018/09/14','R1'),
--('2018/08/01','2018/09/17','R1'),
--('2018/08/02','2018/09/18','R1'),
--('2018/08/03','2018/09/18','R1'),
--('2018/08/04','2018/09/19','R1'),
--('2018/08/05','2018/09/19','R1'),
--('2018/08/06','2018/09/20','R1'),
--('2018/08/07','2018/09/21','R1'),
--('2018/08/08','2018/09/24','R1'),
--('2018/08/09','2018/09/25','R1'),
--('2018/08/10','2018/09/25','R1'),
--('2018/08/11','2018/09/26','R1'),
--('2018/08/12','2018/09/26','R1'),
--('2018/08/13','2018/09/27','R1'),
--('2018/08/14','2018/09/28','R1'),
--('2018/08/15','2018/10/01','R1'),
--('2018/08/16','2018/10/02','R1'),
--('2018/08/17','2018/10/02','R1'),
--('2018/08/18','2018/10/03','R1'),
--('2018/08/19','2018/10/03','R1'),
--('2018/08/20','2018/10/04','R1'),
--('2018/08/21','2018/10/05','R1'),
--('2018/08/22','2018/10/08','R1'),
--('2018/08/23','2018/10/09','R1'),
--('2018/08/24','2018/10/09','R1'),
--('2018/08/25','2018/10/09','R1'),
--('2018/08/26','2018/10/10','R1'),
--('2018/08/27','2018/10/10','R1'),
--('2018/08/28','2018/10/11','R1'),
--('2018/08/29','2018/10/12','R1'),
--('2018/08/30','2018/10/15','R1'),
--('2018/08/31','2018/10/15','R1'),
--('2018/09/01','2018/10/16','R1'),
--('2018/09/02','2018/10/16','R1'),
--('2018/09/03','2018/10/16','R1'),
--('2018/09/04','2018/10/18','R1'),
--('2018/09/05','2018/10/19','R1'),
--('2018/09/06','2018/10/22','R1'),
--('2018/09/07','2018/10/22','R1'),
--('2018/09/08','2018/10/23','R1'),
--('2018/09/09','2018/10/23','R1'),
--('2018/09/10','2018/10/23','R1'),
--('2018/09/11','2018/10/25','R1'),
--('2018/09/12','2018/10/26','R1'),
--('2018/09/13','2018/10/29','R1'),
--('2018/09/14','2018/10/30','R1'),
--('2018/09/15','2018/10/30','R1'),
--('2018/09/16','2018/10/30','R1'),
--('2018/09/17','2018/10/30','R1'),
--('2018/09/18','2018/11/01','R1'),
--('2018/09/19','2018/11/02','R1'),
--('2018/09/20','2018/11/05','R1'),
--('2018/09/21','2018/11/06','R1'),
--('2018/09/22','2018/11/06','R1'),
--('2018/09/23','2018/11/06','R1'),
--('2018/09/24','2018/11/06','R1'),
--('2018/09/25','2018/11/08','R1'),
--('2018/09/26','2018/11/09','R1'),
--('2018/09/27','2018/11/12','R1'),
--('2018/09/28','2018/11/13','R1'),
--('2018/09/29','2018/11/13','R1'),
--('2018/09/30','2018/11/13','R1'),
--('2018/10/01','2018/11/13','R1'),
--('2018/10/02','2018/11/15','R1'),
--('2018/10/03','2018/11/16','R1'),
--('2018/10/04','2018/11/19','R1'),
--('2018/10/05','2018/11/20','R1'),
--('2018/10/06','2018/11/20','R1'),
--('2018/10/07','2018/11/20','R1'),
--('2018/10/08','2018/11/20','R1'),
--('2018/10/09','2018/11/22','R1'),
--('2018/10/10','2018/11/23','R1'),
--('2018/10/11','2018/11/26','R1'),
--('2018/10/12','2018/11/27','R1'),
--('2018/10/13','2018/11/27','R1'),
--('2018/10/14','2018/11/27','R1'),
--('2018/10/15','2018/11/27','R1'),
--('2018/10/16','2018/11/29','R1'),
--('2018/10/17','2018/11/30','R1'),
--('2018/10/18','2018/12/03','R1'),
--('2018/10/19','2018/12/04','R1'),
--('2018/10/20','2018/12/04','R1'),
--('2018/10/21','2018/12/04','R1'),
--('2018/10/22','2018/12/05','R1'),
--('2018/10/23','2018/12/06','R1'),
--('2018/10/24','2018/12/07','R1'),
--('2018/10/25','2018/12/10','R1'),
--('2018/10/26','2018/12/11','R1'),
--('2018/10/27','2018/12/11','R1'),
--('2018/10/28','2018/12/11','R1'),
--('2018/10/29','2018/12/11','R1'),
--('2018/10/30','2018/12/13','R1'),
--('2018/10/31','2018/12/14','R1'),
--('2018/11/01','2018/12/17','R1'),
--('2018/11/02','2018/12/18','R1'),
--('2018/11/03','2018/12/18','R1'),
--('2018/11/04','2018/12/18','R1'),
--('2018/11/05','2018/12/19','R1'),
--('2018/11/06','2018/12/20','R1'),
--('2018/11/07','2018/12/21','R1'),
--('2018/11/08','2018/12/24','R1'),
--('2018/11/09','2018/12/27','R1'),
--('2018/11/10','2018/12/27','R1'),
--('2018/11/11','2018/12/27','R1'),
--('2018/11/12','2018/12/28','R1'),
--('2018/11/13','2018/12/31','R1'),
--('2018/11/14','2019/01/02','R1'),
--('2018/11/15','2019/01/03','R1'),
--('2018/11/16','2019/01/04','R1'),
--('2018/11/17','2019/01/04','R1'),
--('2018/11/18','2019/01/04','R1'),
--('2018/11/19','2019/01/07','R1'),
--('2018/11/20','2019/01/08','R1'),
--('2018/11/21','2019/01/09','R1'),
--('2018/11/22','2019/01/10','R1'),
--('2018/11/23','2019/01/11','R1'),
--('2018/11/24','2019/01/11','R1'),
--('2018/11/25','2019/01/11','R1'),
--('2018/11/26','2019/01/14','R1'),
--('2018/11/27','2019/01/15','R1'),
--('2018/11/28','2019/01/16','R1'),
--('2018/11/29','2019/01/17','R1'),
--('2018/11/30','2019/01/17','R1'),
('2018/12/01','2019/01/17','R1'),
('2018/12/02','2019/01/17','R1'),
('2018/12/03','2019/01/18','R1'),
('2018/12/04','2019/01/22','R1'),
('2018/12/05','2019/01/23','R1'),
('2018/12/06','2019/01/24','R1'),
('2018/12/07','2019/01/24','R1'),
('2018/12/08','2019/01/25','R1'),
('2018/12/09','2019/01/25','R1'),
('2018/12/10','2019/01/28','R1'),
('2018/12/11','2019/01/29','R1'),
('2018/12/12','2019/01/30','R1'),
('2018/12/13','2019/01/31','R1'),
('2018/12/14','2019/01/31','R1'),
('2018/12/15','2019/02/01','R1'),
('2018/12/16','2019/02/01','R1'),
('2018/12/17','2019/02/04','R1'),
('2018/12/18','2019/02/05','R1'),
('2018/12/19','2019/02/06','R1'),
('2018/12/20','2019/02/06','R1'),
('2018/12/21','2019/02/07','R1'),
('2018/12/22','2019/02/07','R1'),
('2018/12/23','2019/02/07','R1'),
('2018/12/24','2019/02/08','R1'),
('2018/12/25','2019/02/08','R1'),
('2018/12/26','2019/02/08','R1'),
('2018/12/27','2019/02/12','R1'),
('2018/12/28','2019/02/13','R1'),
('2018/12/29','2019/02/13','R1'),
('2018/12/30','2019/02/13','R1'),
('2018/12/31','2019/02/13','R1'),
('2019/01/01','2019/02/14','R1'),
('2019/01/02','2019/02/15','R1'),
('2019/01/03','2019/02/18','R1'),
('2019/01/04','2019/02/19','R1'),
('2019/01/05','2019/02/19','R1'),
('2019/01/06','2019/02/19','R1'),
('2019/01/07','2019/02/20','R1'),
('2019/01/08','2019/02/21','R1'),
('2019/01/09','2019/02/22','R1'),
('2019/01/10','2019/02/25','R1'),
('2019/01/11','2019/02/26','R1'),
('2019/01/12','2019/02/26','R1'),
('2019/01/13','2019/02/26','R1'),
('2019/01/14','2019/02/27','R1'),
('2019/01/15','2019/02/28','R1'),
('2019/01/16','2019/03/01','R1'),
('2019/01/17','2019/03/04','R1'),
('2019/01/18','2019/03/05','R1'),
('2019/01/19','2019/03/05','R1'),
('2019/01/20','2019/03/05','R1'),
('2019/01/21','2019/03/06','R1'),
('2019/01/22','2019/03/07','R1'),
('2019/01/23','2019/03/08','R1'),
('2019/01/24','2019/03/11','R1'),
('2019/01/25','2019/03/12','R1'),
('2019/01/26','2019/03/12','R1'),
('2019/01/27','2019/03/12','R1'),
('2019/01/28','2019/03/13','R1'),
('2019/01/29','2019/03/14','R1'),
('2019/01/30','2019/03/15','R1'),
('2019/01/31','2019/03/18','R1'),
('2019/02/01','2019/03/19','R1'),
('2019/02/02','2019/03/19','R1'),
('2019/02/03','2019/03/19','R1'),
('2019/02/04','2019/03/20','R1'),
('2019/02/05','2019/03/21','R1'),
('2019/02/06','2019/03/22','R1'),
('2019/02/07','2019/03/25','R1'),
('2019/02/08','2019/03/26','R1'),
('2019/02/09','2019/03/26','R1'),
('2019/02/10','2019/03/26','R1'),
('2019/02/11','2019/03/27','R1'),
('2019/02/12','2019/03/28','R1'),
('2019/02/13','2019/03/28','R1'),
('2019/02/14','2019/04/01','R1'),
('2019/02/15','2019/04/02','R1'),
('2019/02/16','2019/04/02','R1'),
('2019/02/17','2019/04/02','R1'),
('2019/02/18','2019/04/03','R1'),
('2019/02/19','2019/04/04','R1'),
('2019/02/20','2019/04/04','R1'),
('2019/02/21','2019/04/08','R1'),
('2019/02/22','2019/04/09','R1'),
('2019/02/23','2019/04/09','R1'),
('2019/02/24','2019/04/09','R1'),
('2019/02/25','2019/04/10','R1'),
('2019/02/26','2019/04/11','R1'),
('2019/02/27','2019/04/11','R1'),
('2019/02/28','2019/04/15','R1'),
('2019/03/01','2019/04/16','R1'),
('2019/03/02','2019/04/16','R1'),
('2019/03/03','2019/04/16','R1'),
('2019/03/04','2019/04/17','R1'),
('2019/03/05','2019/04/18','R1');

-- Check for and drop temp tables

IF OBJECT_ID('tempdb..#HH_INFO') IS NOT NULL
DROP TABLE #HH_INFO

IF OBJECT_ID('tempdb..#Result') IS NOT NULL
DROP TABLE #Result

-- Create Results Table

CREATE TABLE #Result

    (
		 [Settlement Date] DATE NULL
		,[Run date] DATE NULL
		,[Settlement Run] VARCHAR (2) NULL
		,[Actual Consumption] NUMERIC (38,4) NULL
		,[Estimated Consumption] NUMERIC (38,4) NULL
		,[AA%] DECIMAL (38,4) NULL 
    )


-- Create Temp HH Info Table

SELECT DISTINCT
 
       [MPxN]
      ,[Move in date]
      ,[Move out date]
      ,[Supply start date]
      ,[Loss or disconnection date]
      ,[Disconnected supply flag]
      ,[Meter removal date]
      ,[Energisation Status]
      ,[Measurement Class]
	  ,[Measure type (Industry)]
      ,[GSP or LDZ (Industry)]
      ,[Profile Class (Ecotricity)]
      ,[Customer type (Industry)]
      ,[Export flag]
      ,[Distributor]

	  INTO #HH_INFO

  FROM [D-OVS16-DWH-01].[Warehouse].[rep].[CSPEAR_LATEST_ROW_VW]

  where [Measure type (ecotricity)] = 'HH'


  		DECLARE @MAXCount INT = (SELECT MAX(id) FROM @Variables)
		DECLARE @SETDATE DATE = (SELECT [Sett Date] FROM @Variables WHERE id = @Count)
		DECLARE @AGDATE DATE = (SELECT [DA Run Date] FROM @Variables WHERE id = @Count)
		DECLARE @Run VARCHAR (2) = (SELECT [Sett Code] FROM @Variables WHERE id = @Count)

WHILE @Count <= @MAXCount

BEGIN

		IF OBJECT_ID('tempdb..#last_read') IS NOT NULL
			DROP TABLE #last_read

		IF OBJECT_ID('tempdb..#Act_values') IS NOT NULL
			DROP TABLE #Act_values

		IF OBJECT_ID('tempdb..#Est_values') IS NOT NULL
		DROP TABLE #Est_values

		-- CREATE TEMP LAST READ TABLE (RELATIVE TO THE SETTLEMENT DATE)

		SELECT DISTINCT 

				J0003
				,MAX(FlowTstamp) AS 'Max_Read_Date'

		into #last_read

		FROM D0036.ZHV Z

		LEFT JOIN D0036.D0036.G101 G1
			ON 
				Z.PK_ZHV = G1.FK_ZHV
		LEFT JOIN D0036.D0036.G102 G2
			ON 
				G1.PK_101 = G2.FK_101
		LEFT JOIN D0036.D0036.G103 G3
			ON 
				G2.PK_102 = G3.FK_102

		WHERE J0073 = @SETDATE

		AND J0103 = 'AI'

		AND FlowTstamp < @AGDATE

		GROUP BY J0003

		--Create actual volume table

		SELECT DISTINCT

		J0073 AS 'Settlement Date'
		,SUM(J0177) AS 'Actual Consumption'

		INTO #Act_values

		FROM D0036.ZHV Z

		LEFT JOIN D0036.D0036.G101 G1
			ON 
				Z.PK_ZHV = G1.FK_ZHV
		LEFT JOIN D0036.D0036.G102 G2
			ON
				G1.PK_101 = G2.FK_101
		LEFT JOIN D0036.D0036.G103 G3
			ON 
				G2.PK_102 = G3.FK_102
		INNER JOIN #last_read
			ON
				G1.J0003 = #last_read.J0003 AND
				FlowTstamp = #last_read.Max_Read_Date
		LEFT JOIN #HH_INFO
			ON
			G1.J0003 = #HH_INFO.MPXN


		WHERE J0103 = 'AI'

		AND J0073 = @SETDATE

		AND #HH_INFO.[Measurement Class] = 'C'

		AND J0020 = 'A' 

				GROUP BY 
					 J0073
					,J0020


		-- Create Estimated volume table

		SELECT DISTINCT

				J0073 AS 'Settlement Date'
			,SUM(J0177) AS 'Estimated Consumption'

		INTO #Est_values

		FROM D0036.ZHV Z

		LEFT JOIN D0036.D0036.G101 G1
			ON 
				Z.PK_ZHV = G1.FK_ZHV
		LEFT JOIN D0036.D0036.G102 G2
			ON
				G1.PK_101 = G2.FK_101
		LEFT JOIN D0036.D0036.G103 G3
			ON 
				G2.PK_102 = G3.FK_102
		INNER JOIN #last_read
			ON
				G1.J0003 = #last_read.J0003 AND
				FlowTstamp = #last_read.Max_Read_Date
		LEFT JOIN #HH_INFO
			ON
			G1.J0003 = #HH_INFO.MPXN

		WHERE J0103 = 'AI'

		AND J0073 = @SETDATE

		AND J0020 = 'E'

		AND #HH_INFO.[Measurement Class] = 'C' 

		GROUP BY 
			 J0073
			,J0020


		-- INSERT INTO RESULTS TABLE

			INSERT INTO #Result
		(
				 [Settlement Date] 
				,[Run date]
				,[Settlement Run]
				,[Actual Consumption]
				,[Estimated Consumption]
				,[AA%]
		)
		SELECT 

			#Act_values.[Settlement Date]
			,@AGDATE AS 'Run date'
			,@Run AS 'Settlement Run'
			,#Act_values.[Actual Consumption]
			,#Est_values.[Estimated Consumption]
			,ROUND(SUM([Actual Consumption]) / (SUM([Actual Consumption])+SUM([Estimated Consumption])),4) AS 'AA%'

		FROM #Act_values
			INNER JOIN #Est_values
				ON #Act_values.[Settlement Date] = #Est_values.[Settlement Date]

		GROUP BY

						 #Act_values.[Settlement Date]
						,#Act_values.[Actual Consumption]
				,#Est_values.[Estimated Consumption]



	SET @Count += 1
	SET @SETDATE = (SELECT [Sett Date] FROM @Variables WHERE id = @Count)
	SET @AGDATE  = (SELECT [DA Run Date] FROM @Variables WHERE id = @Count)
	SET @Run  = (SELECT [Sett Code] FROM @Variables WHERE id = @Count)

	DECLARE @PrintMessage NVARCHAR(50) =
	 CAST(@COUNT AS NVARCHAR(30))
	 + N' Of '
	 +CAST(@MAXCount AS NVARCHAR(30));

	DECLARE @ts AS VARCHAR(10) = CONVERT(CHAR(10), SYSDATETIME() , 108);
    RAISERROR( 'Timestamp %s', 1, 0, @ts) WITH NOWAIT;
    RAISERROR( 'Progress %s', 1, 0, @PrintMessage) WITH NOWAIT;

END

SELECT * FROM #Result